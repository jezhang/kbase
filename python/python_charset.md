
Python字符集和字符编码
===================

很多时候我们会看到Python程序文件的第一行开始有这样一行注释：

```python
# -*- coding: utf-8 -*-
```

这其中涉及字符，字符集和字符编码等相关内容，下面先解释一下这三个概念。

- 字符(Character)：是各种文字和符号的总称，包括各国家文字、标点符号、图形符号、数字等。
- 字符集(Character set)：是多个字符的集合，字符集的种类较多，每个字符集包含的字符个数也不同，常见的字符集名称包括：ASCII字符集、GB2312字符集、BIG5字符集、GB18030字符集、Unicode字符集等。
- 字符编码(Character encoding)：也称字节码，是把字符集中的字符编码为指定集合中的某一个对象（例如：比特模式、自然数序列、8位组或电脉冲），以便在计算机中存储和通过通信网络传递文本。常见的例子包括将拉丁字母表编码成摩尔斯电码和ASCII。其中，ASCII将字母、数字和其他符号进行编号，并用7比特的二进制来表示这个整数。通常会额外使用一个扩充的比特，以便于以1个字节的方式进行存储。

> 简单地说，编码就是实用一个计算机能够识别的数字来代表一个文字，计算机在处理的时候不关心具体的文字、只关心文字的编码，这样就可以使用计算的方式来处理文字了。

### ASCII字符集和编码

在所有的字符集中，ASCII字符集是早期计算机操作系统中的最要字符集。其主要包括控制字符（回车键、退格、换行键等）和可显示字符（英文大小写字符、阿拉伯数字和西文符号）。

ASCII字符集最大的缺点就是只能显示标准26个拉丁字母、阿拉伯数字和英式标点，当需要显示外来语（中文，日文）时就无能为力了。所以当今主流的操作系统都开始使用Unicode编码了。

### Unicode字符集和UTF-8编码

其实，在Unicode编码流行起来之前，很多国家为了计算机的普及都付出了努力，比如我国制定的国标编码GB2312，日本的Shift JIS编码等。为了使原来只支持英文的计算机也支持本国的语言，这些国家和地区都做出了贡献。不过随着多国语言同屏显示的需求产生，一种统一的、通用的可以同时编码绝大多数语言的编码被发明了出来，这就是Unicode编码。

前文所说的UTF-8就是针对Unicode字符集的一种字符编码，UTF-8可以根据不同的符号自动选择编码的长短，以提高Unicode的编码效率。而且UTF-8时ASCII的一个超集，一个纯ASCII字符串，也是一个合法的UTF-8字符串。既然有UTF-8，那么有没有UTF-16，UTF-32呢？答案是：有。它们同样都是针对Unicode字符集进行编码，不过各有特点，到今天我们几乎只使用UTF-8编码了。

早期的Python版本为什么不支持Unicode编码，原因是早期的Python版本发布的年代还没有Unicode编码，所以Python2.7到现在为止的默认编码仍然是ASCII，这就又回到了本章开头的部分——也就说明了为什么要在程序文件的一开始增加：

```python
# -*- coding: utf-8 -*-
```

这样一行注释是告诉Python解释器，这个文件需要以UTF-8的编码方式解码，这样才能够在程序中使用非ASCII字符，比如中文字符：

```python
>>> ord('a')
97
>>>
>>> chr(97)
'a'
>>>
>>> u'我'
u'\u6211'
>>>
>>> u'我'.encode('utf-8')
'\xe6\x88\x91'
>>>
>>> u'我'.encode('GBK')
'\xce\xd2'
>>>
>>> '我'.encode('GBK')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
UnicodeDecodeError: 'ascii' codec cant decode byte 0xe6 in position 0: ordinal not in range(128)
```

一个中文字符，或者一个字符串前面增加一个小写字母u则表示这是Unicode字符集中的一个字符。直接在Python shell中打印则可以查看其默认的Unicode编码，而使用字符串的encode()方法可以将其编码为Python支持的任意字符编码，上面的例子中还展示了“我”的UTF-8编码和GBK编码。

如果忘记了在中文字符串前面加u，在Python shell中会直接报UnicodeDecodeError的错误。但在Python脚本文件中，因为已经在文件一开始增加了UTF-8编码的注释行，所以即便不在中文字符串前增加u，程序也可以正常运行。

如果你使用的是Windows系统，而不是Linux或Mac OS X系统，那么很多由系统工具（如记事本）生成的文件可能不是UTF-8编码的，而是GBK编码。如果读取Windows中的文件产生了乱码，可以尝试使用decode('GBK')将GBK编码的字符串转换成Unicode编码的字符串

```python
gbk_string.decode("GBK")
```




